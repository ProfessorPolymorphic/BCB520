---
title: "Example 1: Grant Expenditures"
date: "2024-01-12"
format:
  html:
    code-fold: true
categories: [Tutorial, Quarto, Literate Programming, Plotly, Interactive]
image: grantvis.png


---
![](grantvis.png)
## Aggregating financial data for a grant

This is for my NIH grant and it uses the transaction detail report.


```{r}

library(tidyverse)
library(lubridate)
library(plotly)

SEPA <- read.csv("SEPA.csv")

SEPAsmall <- SEPA %>%
  select(Transaction.Date, Transaction.Type, PE, PE.Title,
         Original.Budget, YTD, Encumbrance, Adjusted.Budget)%>%
  filter(PE != "RV")%>%
  mutate(Category = if_else(PE == 60, "F&A", "Direct"))%>%
  mutate(date = mdy(Transaction.Date),
         month = month(date))%>%
  group_by(Category, month)%>%
  summarise(Total = sum(YTD))


p <- plot_ly(SEPAsmall, x = ~month, y = ~Total, color = ~Category, type = 'bar') %>%
  layout(barmode = 'stack')

p


```


## IIDS Grants

```{r}

IIDS <- read.csv("IIDS.csv")


IIDSsmall <- IIDS %>%
  select(Grant.Code, PI.Name, Transaction.Date, Transaction.Type, PE, PE.Title,
         Fund.Type.Title, Original.Budget, YTD, Encumbrance, Adjusted.Budget)%>%
  filter(PE.Title != "Revenue")%>%
  filter(PI.Name != "")%>%
  mutate(Category = if_else(PE.Title == "Overhead", "F&A", "Direct"))%>%
  mutate(date = mdy(Transaction.Date),
         month = month(date),
         year = year(date))%>%
  group_by(Category, year, PI.Name, Grant.Code)%>%
  summarise(Total = sum(YTD))

plot_ly(IIDSsmall, x = ~PI.Name, y = ~Total, color = ~Category, type = 'bar') %>%
  layout(barmode = 'stack')

ggplot(IIDSsmall, aes(x=PI.Name, y = Total, fill = Category))+
  geom_col(position = "stack")+
  theme(axis.text.x = element_text(angle =90, hjust = 1))+
  facet_wrap(~year)
  

```



